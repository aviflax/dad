#!/usr/bin/env bash
# shellcheck disable=SC2016

set -eu

if [ -z "$NATIVE_IMAGE" ]; then
    echo 'Please set $NATIVE_IMAGE'
    exit 1
fi

rm -Rf classes
mkdir classes

clojure -A:compile-for-native-image -e "(compile 'dad.cli)"

$NATIVE_IMAGE \
    -cp "$(clojure -A:compile-for-native-image -Spath):classes" \
    -H:Name=dad \
    -H:+ReportExceptionStackTraces \
    --initialize-at-build-time  \
    --verbose \
    --no-fallback \
    --no-server \
    "-J-Xms5g" \
    "-J-Xmx5g" \
    dad.cli
